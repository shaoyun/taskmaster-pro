# TaskMaster Pro - 需求文档

## 日历周视图功能需求

### 1. 智能滚动定位
**需求描述：** 周视图默认滚动到最早任务时间的前30分钟处，避免无任务时段显示空白页面。

**实现细节：**
- 扫描当前周内所有未完成任务
- 找到最早的任务时间
- 自动滚动到该时间前30分钟的位置
- 如果当周没有任务，默认滚动到上午8:00

**用户价值：** 提升用户体验，用户打开周视图时立即看到有任务的时段，无需手动滚动查找。

---

### 2. 任务堆叠显示
**需求描述：** 同一时间段有多个任务时，各任务向左错开显示，避免重叠遮挡。

**实现细节：**
- 检测时间重叠的任务（1小时时间窗口内的任务）
- 每个任务向左偏移20像素（TASK_OFFSET = 20）
- 最多显示3个任务
- 保持任务可见性和可点击性

**用户价值：** 清晰展示同时段的多个任务，避免任务被完全遮挡。

---

### 3. 悬停交互优化
**需求描述：** 鼠标悬停在堆叠任务上时，该任务自动提升到最前显示；移开后恢复原有层级。

**实现细节：**
- 使用 z-index 控制任务层级
- 默认 z-index: 10 + index
- 悬停时 z-index: 50
- 添加平滑过渡效果和阴影提示

**用户价值：** 改善交互体验，用户可以清楚查看堆叠任务的完整信息。

---

### 4. 任务溢出处理
**需求描述：** 当同一时段任务超过3个时，显示"更多"指示器，点击后弹窗展示所有任务。

**实现细节：**
- 最多显示3个任务卡片
- 第4个位置显示"+N 更多"占位符
- 点击占位符打开模态对话框
- 对话框列出该时段所有任务
- 支持在对话框内点击任务查看详情

**用户价值：** 避免界面拥挤，同时保证所有任务可访问。

---

### 5. 节假日精确显示
**需求描述：** 每个具体日期独立显示对应的节假日名称，不合并显示；补班日期单独标识。

**实现细节：**
- 一天可显示多个节假日标签（如国庆节+中秋节重合）
- 放假日：红色背景 + 红色文字
- 补班日：琥珀色背景 + 琥珀色文字 + 边框 + "(补班)"后缀
- 每个节假日独立显示，不合并文本

**用户价值：** 准确传达节假日信息，帮助用户安排工作计划，避免混淆。

---

### 6. 任务数量指示器
**需求描述：** 日期头部右上角显示彩色小方点，直观展示当日任务数量。

**实现细节：**
- 位置：日期格子右上角
- 形状：2x2像素的圆角小方块
- 颜色规则：
  - **绿色**：0个任务（空闲）
  - **黄色**：1-2个任务（正常）
  - **红色**：3个及以上任务（繁忙）
- 鼠标悬停显示具体任务数量

**用户价值：** 快速识别工作负载分布，便于一周任务规划和调整。

---

### 7. 延期任务视觉提示
**需求描述：** 已过期但未完成的任务，左侧竖线显示为红色，优先于优先级颜色。

**实现细节：**
- 判断条件：任务截止时间 < 当前时间 且 状态 ≠ 已完成
- 延期任务强制使用红色左边框（border-red-500）和红色背景（bg-red-50）
- 优先级高于普通的优先级配色规则
- 应用于周视图的任务卡片和溢出弹窗

**用户价值：** 立即识别逾期任务，提醒用户及时处理，避免遗漏重要任务。

---

### 8. 月视图日期字号优化
**需求描述：** 月视图中的日期数字采用更大的字号，提升可读性。

**实现细节：**
- 日期数字字号：从 `text-xs`（0.75rem）调整为 `text-sm`（0.875rem）
- 今日标记圆形尺寸：从 `w-6 h-6` 调整为 `w-7 h-7`
- 保持整体布局平衡，不影响其他元素

**用户价值：** 提高月视图的视觉清晰度，特别是在较小屏幕上查看时更加友好。

---

### 9. 日历默认视图模式
**需求描述：** 日历视图默认显示周视图而非月视图。

**实现细节：**
- 初始化 `activeTab` 状态为 `'week'` 而非 `'month'`
- 用户打开日历功能时直接进入周视图
- 可通过顶部切换按钮手动切换到月视图

**用户价值：** 周视图提供更详细的时间轴和任务分布信息，更适合日常任务管理场景。

---

### 10. 移除已完成任务视图
**需求描述：** 移除左侧边栏的"已完成"菜单项及其独立视图，已完成任务可通过"所有任务"视图的筛选功能查看。

**实现细节：**
- 从 `ViewMode` 类型定义中移除 `'completed'`
- 移除边栏的"已完成"按钮及相关代码
- 保留"所有任务"视图中的状态筛选功能
- 用户可在"所有任务"中筛选"已完成"状态查看完成的任务

**用户价值：** 简化导航菜单，减少视图切换复杂度，统一任务查看入口。

---

### 11. 任务卡片固定高度显示
**需求描述：** 收集箱、今日任务、明日任务视图中的任务卡片采用等高布局，每行卡片高度一致。

**实现细节：**
- 使用 CSS Grid 的 `auto-rows-fr` 实现等高布局
- 在 `inbox`、`today`、`tomorrow` 视图中启用固定高度
- TaskCard 组件添加 `h-full` 类名，完全填充容器
- 设置最小高度 `min-h-[120px]` 确保卡片不会过小
- PC视图（lg及以上）设置最大高度 `lg:max-h-[250px]` 避免卡片过高
- 其他视图（延期任务、所有任务等）保持自适应高度

**用户价值：** 提升视觉整齐度，使界面更加美观和专业，同时避免卡片过高影响整体布局。

---

### 12. 移动端响应式优化
**需求描述：** 优化移动设备上的显示效果，提升触控体验。

**实现细节：**
- 网格布局响应式调整：
  - 小屏（默认）：1列
  - 中屏（sm）：2列
  - 大屏（lg）：2列
  - 超大屏（xl）：3列
  - 超超大屏（2xl）：4列
- 内容区域内边距响应式调整：
  - 移动端：`p-3`（0.75rem）
  - 小屏：`sm:p-4`（1rem）
  - 中屏：`md:p-6`（1.5rem）
  - 大屏：`lg:p-8`（2rem）
- 底部间距优化：移动端 `pb-4`，桌面端 `md:pb-20`
- 四象限视图间距：移动端 `gap-3`，桌面端 `sm:gap-4`

**用户价值：** 在各种屏幕尺寸上都能获得良好的使用体验，特别优化了触控操作。

---

## 技术实现说明

### 技术栈
- React + TypeScript
- Tailwind CSS
- date-fns (日期处理)

### 关键组件
- [WeekView.tsx](components/Calendar/WeekView.tsx) - 周视图主组件
- [MonthView.tsx](components/Calendar/MonthView.tsx) - 月视图主组件

### 核心常量
```typescript
const PIXELS_PER_HOUR = 60;        // 每小时60像素（1分钟1像素）
const TASK_OFFSET = 20;            // 堆叠任务偏移量（像素）
const MAX_VISIBLE_TASKS = 3;       // 最大可见任务数
```

### 视觉规范

#### 任务优先级与状态配色
| 状态/优先级 | 背景色 | 边框色 | 文字颜色 | 优先级 |
|------------|--------|--------|----------|--------|
| 延期任务 | bg-red-50 | border-red-500 | text-red-700 | **最高** |
| Q1 (重要且紧急) | bg-red-50 | border-red-500 | text-red-700 | 高 |
| Q2 (重要不紧急) | bg-blue-50 | border-blue-500 | text-blue-700 | 中 |
| Q3 (紧急不重要) | bg-amber-50 | border-amber-500 | text-amber-700 | 低 |
| Q4 (不重要不紧急) | bg-slate-50 | border-slate-400 | text-slate-700 | 最低 |

#### 任务数量指示器
| 任务数量 | 颜色 | 类名 | 含义 |
|---------|------|------|------|
| 0 | 绿色 | bg-green-500 | 空闲 |
| 1-2 | 黄色 | bg-yellow-500 | 正常 |
| 3+ | 红色 | bg-red-500 | 繁忙 |

#### 节假日标识
| 类型 | 背景色 | 文字颜色 | 边框 | 后缀 |
|------|--------|----------|------|------|
| 放假日 | bg-red-50 | text-red-600 | 无 | 无 |
| 补班日 | bg-amber-50 | text-amber-700 | border-amber-200 | (补班) |

### 性能优化
- 任务分组算法优化重叠检测
- 使用 React Fragment 减少 DOM 节点
- 合理使用 z-index 避免重绘

---

## 更新日志

### v1.3.0 (2025-11-28)
- ✅ 移除"已完成"视图菜单项
- ✅ 任务卡片固定等高布局（收集箱、今日、明日）
- ✅ 移动端响应式优化（网格、间距、触控）

### v1.2.0 (2025-11-28)
- ✅ 延期任务红色左边框显示
- ✅ 月视图日期数字字号调整（text-xs → text-sm）
- ✅ 堆叠任务偏移量调整（15px → 20px）
- ✅ 日历默认视图改为周视图

### v1.1.0 (2025-11-28)
- ✅ 智能滚动定位功能
- ✅ 任务堆叠显示（15px偏移）
- ✅ 悬停交互优化
- ✅ 任务溢出处理
- ✅ 节假日精确显示
- ✅ 任务数量指示器

---

## 未来规划

### 待开发功能
- [ ] 任务拖拽调整时间
- [ ] 自定义任务时长
- [ ] 周视图打印功能
- [ ] 任务颜色自定义
- [ ] 多日历视图切换动画
