# 任务列表视图设计规范

> 文档创建时间：2025-12-19
> 版本：v1.0

## 概述

任务列表视图（TaskListView）是 TaskMaster Pro 的核心功能之一，提供基于冲刺的任务筛选和管理能力。本文档记录了该视图的设计决策、交互规范和 UI 细节。

---

## 核心设计原则

### 1. 冲刺为核心

任务列表**必须基于冲刺**运作：
- 用户必须先选择一个冲刺，才能查看和管理任务
- 切换冲刺时，自动重置所有附加筛选条件
- 新建任务自动关联当前选中的冲刺

### 2. 筛选条件分层

筛选条件分为两个层级：

| 层级 | 类型 | 说明 |
|------|------|------|
| **基础筛选** | 冲刺选择 | 必选，单选，决定任务数据集 |
| **附加筛选** | 状态、优先级、标签 | 可选，基于冲刺数据进行二次过滤 |

### 3. 单选与多选规则

| 筛选项 | 选择模式 | 交互行为 |
|--------|----------|----------|
| **冲刺** | 单选 | 点击切换，自动清除其他筛选 |
| **状态** | 单选 | 点击切换，再次点击取消选择 |
| **优先级** | 单选 | 点击切换，再次点击取消选择 |
| **标签** | 多选 | 点击添加/移除，支持同时选择多个 |

---

## UI 规范

### 侧边栏布局

```
┌─────────────────────────┐
│  🚀 选择冲刺            │  ← 区块标题（可折叠）
│  ├── Sprint 2025-12-19  │
│  └── Sprint 2025-12-12  │
├─────────────────────────┤  ← 分割线
│  🔍 筛选条件    [清除]  │  ← 区块标题 + 清除按钮
│                         │
│  状态 (单选)            │  ← 维度标题
│  ├── 待安排             │
│  ├── 进行中             │
│  └── 已完成             │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │  ← 分割线
│  优先级 (单选)          │
│  ├── 🔥 重要且紧急      │
│  ├── ⭐ 重要不紧急      │
│  ├── ⏰ 紧急不重要      │
│  └── ⭕ 不紧急不重要    │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │  ← 分割线
│  标签 (多选)            │
│  ├── ☑️ BUG修复         │
│  └── ☐ 优化             │
└─────────────────────────┘
```

### 筛选条件顺序

**顺序规则**：状态 → 优先级 → 标签

理由：
1. 状态和优先级是任务的核心属性，使用频率高
2. 标签作为自定义分类，放在最后

### 字体规范

| 元素 | 字体大小 | 字重 | 颜色 |
|------|----------|------|------|
| 区块标题（选择冲刺/筛选条件） | `text-sm` (14px) | `font-bold` | `text-slate-600` |
| 维度标题（状态/优先级/标签） | `text-sm` (14px) | `font-semibold` | `text-slate-600` |
| 提示文字（单选/多选） | `text-xs` (12px) | `font-normal` | `text-slate-400` |
| 筛选项文字 | `text-sm` (14px) | 正常/`font-medium` | `text-slate-700` / 激活时 `text-white` |

> **设计原则**：区块标题和维度标题的字体大小应**等于或大于**筛选项文字字体，以建立清晰的视觉层级。

### 背景色规范

| 区域 | 背景色 |
|------|--------|
| 侧边栏整体 | `bg-gradient-to-b from-slate-50 via-slate-50/30 to-white` |
| 主内容区域 | `bg-white` |
| 表格头部 | `bg-slate-50` |

### 分割线规范

- 使用细线条 `border-t border-slate-200/60` 分隔区块
- **不使用**大间距（如 `space-y-6`）作为分隔
- 分割线颜色保持一致，60% 透明度

### 优先级图标

| 优先级 | 图标 | 说明 |
|--------|------|------|
| Q1 重要且紧急 | 🔥 `Flame` | 火焰，表示紧迫 |
| Q2 重要不紧急 | ⭐ `Star` | 星星，表示重要 |
| Q3 紧急不重要 | ⏰ `Clock` | 时钟，表示时效 |
| Q4 不紧急不重要 | ⭕ `Circle` | 圆圈，表示普通 |

---

## 交互规范

### 一键清除筛选

- 当有任何附加筛选条件激活时，显示「清除」按钮
- 点击「清除」按钮，重置：状态、优先级、标签
- **不重置**冲刺选择

### 任务计数

| 位置 | 计数范围 |
|------|----------|
| 冲刺列表 | 全局该冲刺的未完成任务数 |
| 状态筛选 | 当前冲刺内各状态的任务数 |
| 优先级筛选 | 当前冲刺内各优先级的任务数 |
| 标签筛选 | 当前冲刺内包含该标签的任务数 |

### 表格规范

- 使用 `divide-y divide-slate-100` 分隔行
- 最后一行需有底部边框：`border-b border-slate-100`
- 悬停时显示操作按钮（编辑、删除）
- 点击任务行可编辑任务

---

## 防抖动技术规范

为保证界面在筛选状态变化时不产生布局抖动（Layout Shift），需遵循以下技术规范：

### 1. 筛选计数徽标

徽标（Badge）需**预留固定空间**，即使徽标不显示也要占位：

```tsx
{/* 预留固定宽度避免抖动 */}
<span className="w-5 h-5 flex items-center justify-center">
    {activeFilterCount > 0 && (
        <span className="bg-indigo-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">
            {activeFilterCount}
        </span>
    )}
</span>
```

### 2. 清除按钮

清除按钮**始终渲染**，通过 `opacity` 和 `pointer-events` 控制显隐，而非条件渲染：

```tsx
{/* 清除按钮 - 始终渲染，通过透明度控制显隐 */}
<button
    onClick={handleClear}
    className={`text-xs ... transition-all ${
        activeFilterCount > 0 ? 'opacity-100' : 'opacity-0 pointer-events-none'
    }`}
>
    清除
</button>
```

### 3. 避免条件渲染导致布局变化

**错误做法**：
```tsx
{condition && <Element />}  // ❌ 元素出现/消失会改变布局
```

**正确做法**：
```tsx
<Element className={condition ? 'opacity-100' : 'opacity-0 pointer-events-none'} />  // ✅ 元素始终存在
```

---

## 命名规范

### 页面命名

| 原名称 | 新名称 | 说明 |
|--------|--------|------|
| 收集箱 | ✅ **草稿箱** | 更准确地描述未分配任务的性质 |

---

## 相关组件

- `TaskListView.tsx` - 任务列表视图主组件
- `TreeItem` - 筛选项通用组件
- `TaskModal` - 任务编辑弹窗

---

## 变更记录

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2025-12-19 | v1.0 | 初始版本，定义核心设计规范 |
| 2025-12-19 | v1.1 | 更新字体规范（区块/维度标题改为text-sm），新增防抖动技术规范 |
